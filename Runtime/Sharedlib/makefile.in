#**************************************************************************#
#* FILE   **************          makefile         ************************#
#* @configure_input@
#************************************************************************ **#
#* Author: Patrick Miller December 23 2000				  *#
#**************************************************************************#
#*  *#
#**************************************************************************#

srcdir = @srcdir@
top_srcdir = @top_srcdir@
VPATH = @srcdir@
top_builddir = @top_builddir@

sources = p-worker.c p-timer.c p-spawn.c              \
	p-wait.c p-ready.c p-ppp.c p-dsa.c          \
	p-error.c p-signal.c p-globals.c            \
	p-fibre.c p-util.c p-interface.c            \
	p-init.c p-pointer.c p-sdbx.c		    \
	p-tracer.c 				    \
	vectorIO.c READ.c

libraries = libsisal.a srt0.o

includes = $(top_builddir)/Include/sisalConfig.h \
	$(top_builddir)/Include/sisalPaths.h \
	$(top_builddir)/Include/sisalInfo.h \
	sisalrt.h $(srcdir)/arrays.h $(srcdir)/fibre.h $(srcdir)/interface.h \
	$(srcdir)/locks.h $(srcdir)/process.h $(srcdir)/sisalfli.inc \
	$(top_srcdir)/Runtime/@model@Model/lock-implementation.h \
	$(top_srcdir)/Runtime/@model@Model/process-implementation.h \
	$(top_srcdir)/Runtime/@model@Model/parallelism.h

man=$(srcdir)/s.out.1

include $(top_builddir)/Include/makefile.inc
CFLAGS:=$(RUNTIMEFLAGS)

libsisal.a: $(objects)
	$(RM) $@
	$(LD-AR) $@ $(objects)
	$(RANLIB) $@

.PHONY: newoptions
newoptions:
	$(top_srcdir)/Utilities/parseopts < options -usage "man.update" usage.h options.h
	awk '{print} /.\\" Start options/{exit}' < $(srcdir)/s.out.1 > s.out.1.new
	cat man.update >> s.out.1.new
	awk '/.\\" End options/{flag=1} {if (flag) print}' < $(srcdir)/s.out.1 >> s.out.1.new
	mv $(srcdir)/s.out.1 s.out.1.bu
	mv s.out.1.new $(srcdir)/s.out.1


clean:
	$(RM) libsisal.a srt0.o $(objects)
